<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.prisonapp.business.dao.dw_supervise.SuperviseDao">
    <select id="getApplyLeaveList"  resultType="com.prisonapp.business.entity.dw_supervise.GetApplyLeaveListModel">
    select leaveorder as code,statuscode as statusCode, states as status,personname as applicant,subittimestamp as applyTimestamp,starttimestamp as  startTimestamp,endtimestamp as endTimestamp,
    leavedestination as  address,  reason,recording as reasonAudioUrl FROM t_leave where personid=#{userId} and statuscode=#{statusCode}
     ORDER BY subittimestamp DESC LIMIT #{requestCount} OFFSET #{count}
    </select>

    <select id="getTotalApplyLeaveList" resultType="com.prisonapp.business.entity.dw_supervise.SuperviseModel">
        select * FROM t_leave where personid=#{userId} and statuscode=#{statusCode}
    </select>

    <select id="applyRecord"  resultType="com.prisonapp.business.entity.dw_supervise.ApplyRecordModel">
    select  statuscode as statusCode,states as status,auditordatetime as timestamp,accountname as  person from t_auditor where leaveorder=#{code}
     </select>

    <insert id="submitApplyLeave" parameterType="com.prisonapp.business.entity.dw_supervise.SuperviseModel">
        INSERT INTO t_leave(personid, leaveorder,starttimestamp,endtimestamp,reason,recording,provincecode,provincename,citycode,cityname,areacode,areaname)
        VALUES              (#{userId}, #{code},#{startDate},#{endDate},#{submitApplyLeaveModel.reason},#{submitApplyLeaveModel.reasonAudioUrl},#{submitApplyLeaveModel.provinceCode},#{submitApplyLeaveModel.province},#{submitApplyLeaveModel.cityCode},#{submitApplyLeaveModel.city},#{submitApplyLeaveModel.districtCode},#{submitApplyLeaveModel.district});

        INSERT INTO t_auditor(leaveorder,leavingmessage,statuscode,states) VALUES (#{code},#{submitApplyLeaveModel.reason},1,'待审核')

    </insert>

    <select id="getSuperviseTask" resultType="com.prisonapp.business.entity.dw_supervise.GetSuperviseTaskModel">
        SELECT bailoutbegindate as startDate,type,typename FROM  t_personinformation FULL JOIN   t_singin on (t_personinformation.personid = t_singin.personid) where t_personinformation.personid ='25' and createtime BETWEEN CURRENT_DATE and CURRENT_DATE+1

    </select>

    <select id="faceRecognize" resultType="com.prisonapp.business.entity.dw_supervise.FaceRecognizeModel">
    select * from t_singin
    </select>

    <insert id="autoLocation" >
        insert into t_location (latitude,longitude,locationtype,address,personid,timestamp) values (#{latitude},#{longitude},#{locationType},#{address},#{userId},#{date})
    </insert>

    <insert id="uploadLocationError">
        insert into t_log(operator,action,operatingtime,logtype,errorcode) values(#{userId},#{errorMsg},#{date},'2',#{errorCode})
    </insert>

    <insert id="uploadBattery">
        insert into t_location(personid,timestamp,surpluselectricity) values(#{userId},#{date},#{percent})
    </insert>

    <insert id="batteryAlarm">
        insert into t_protectionmessage
    </insert>
</mapper>