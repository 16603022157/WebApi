<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.admin.admin.dao.dw_leave.LeaveDao">
    <select id="getLeave" parameterType="com.admin.model.search.SearchModel" resultType="com.admin.model.leave.LeavefModel">
        SELECT a.*,b.auditordatetime FROM t_leave AS a
        LEFT JOIN t_auditor AS b ON a.leaveorder=b.leaveorder
        <if test="PersonId !=null and PersonId!='' and Condition==null"  >
            WHERE a.personid=#{PersonId}
        </if>
        <if test="Condition ==null and PersonName!=null ">
            where a.personname like concat('%',#{PersonName},'%')
        </if>
        <if test="Condition !=null and PersonName==null and PersonId==null ">
            where a.states like concat('%',#{condition},'%')
        </if>

        <if test="Condition !=null and PersonName==null and PersonId !=null ">
            where a.personid=#{PersonId} and a.states like concat('%',#{condition},'%')
        </if>



        <if test="Condition !=null and PersonName!=null and PersonName!='' and StartTime!=null and EndTime!=null ">
            WHERE a.states=#{Condition}
            a.personname like concat('%',#{PersonName},'%') and
            a.subittimestamp > #{StartTime} and a.subittimestamp &lt; #{EndTime}
        </if>
        <if test="Condition ==null and (PersonName!=null or PersonName=='') and StartTime!=null and EndTime!=null ">
            WHERE a.personname like concat('%',#{PersonName},'%') and
            a.subittimestamp &gt; #{StartTime} and a.subittimestamp &lt; #{EndTime}
        </if>

        <if test="Condition ==null and (PersonName==null or PersonName=='') and StartTime!=null and  EndTime!=null ">
            WHERE a.subittimestamp > TO_TIMESTAMP(#{StartTime}, 'YYYY-MM-DD HH24:MI:SS') and a.subittimestamp &lt; TO_TIMESTAMP(#{EndTime}, 'YYYY-MM-DD HH24:MI:SS')
        </if>
        <if test="Condition ==null and (PersonName==null or PersonName=='') and StartTime!=null and EndTime==null ">
            WHERE a.subittimestamp > TO_TIMESTAMP(#{StartTime}, 'YYYY-MM-DD HH24:MI:SS')
        </if>
        <if test="Condition ==null and (PersonName==null or PersonName=='') and StartTime==null and EndTime!=null ">
            WHERE a.subittimestamp &lt; TO_TIMESTAMP(#{EndTime}, 'YYYY-MM-DD HH24:MI:SS')
        </if>
        <if test="list.size()>0">
            where a.id in
            <foreach collection="list" item="id" index="index" open="(" close=")" separator=",">
                #{id}
            </foreach>
        </if>


    </select>
    <insert id="insertAuditor" parameterType="com.admin.admin.entity.dw_auditor.AuditorInformation">
        insert into t_auditor(leaveorder,accountname,auditordatetime,leavingmessage,statuscode,states) VALUES (#{leaveorder},#{accountname},#{auditordatetime},#{leavingmessage},#{statuscode},#{states})
    </insert>
    <update id="updateLeaveStatus" parameterType="com.admin.admin.entity.dw_auditor.AuditorInformation">
        update t_leave set statuscode=#{statuscode},states=#{states} WHERE leaveorder=#{leaveorder}
    </update>
    <delete id="deleteAuditor" parameterType="String">
        delete from t_auditor where leaveorder=#{leaveOrder}
    </delete>
    <select id="getLeaveInformation" parameterType="String"
            resultType="com.admin.admin.entity.dw_leave.LeaveInformation">
        select * FROM t_leave WHERE leaveorder=#{leaveorder}
    </select>
    <update id="cancelAuditor" parameterType="String">
        update t_auditor set statuscode=4,states='已销假' WHERE leaveorder=#{leaveorder}
    </update>

<select id="countLeavearea" resultType="com.admin.admin.entity.dw_leave.PersonInformation">
    select detail from dictionary    where   code  like  '%000000%'   and  kind ='06'   and detail like concat(concat('%',#{city}),'%') and code  !='440600000000'
</select>

    <select id="countLeavepersonid"  resultType="com.admin.admin.entity.dw_leave.PersonInformation">
        select personid from t_personinformation where policestation like concat(concat('%',#{city}),'%') and policestation like concat(concat('%',#{area}),'%')
<!--        <if test="city!=null">-->
<!--        where policestation like concat(concat('%',#{city}),'%')-->
<!--        </if>-->
<!--        <if test="area!=null">-->
<!--            and policestation like concat(concat('%',#{area}),'%')-->
<!--        </if>-->
    </select>

    <select id="countLeave" resultType="com.admin.admin.entity.dw_leave.LeaveInformation">
        select * from t_leave where personid =#{personid} and subittimestamp &lt;#{endTime} and subittimestamp>#{startTime};
    </select>

    <select id="getPoliceStation" resultType="com.admin.admin.entity.dw_leave.PersonInformation">
        <if test="area.equals('禅城区')">
            select detail from dictionary    where   code  like  '%440604%'   and  kind ='06'  and   code  like  '%0000%' and detail like '%派出所%' and dictionary.detail not in(select detail from dictionary    where   code  like  '%440604%'   and  kind ='06'  and   code  like  '%0000%' and detail like '%已撤销%')
        </if>
        <if test="area.equals('南海区')">
            select detail from dictionary    where   code  like  '%440605%'   and  kind ='06'  and   code  like  '%0000%' and detail like '%派出所%' and dictionary.detail not in(select detail from dictionary    where   code  like  '%440605%'   and  kind ='06'  and   code  like  '%0000%' and detail like '%已撤销%')
        </if>
        <if test="area.equals('三水区')">
            select detail from dictionary    where   code  like  '%440607%'   and  kind ='06'  and   code  like  '%0000%' and detail like '%派出所%' and dictionary.detail not in(select detail from dictionary    where   code  like  '%440607%'   and  kind ='06'  and   code  like  '%0000%' and detail like '%已撤销%')
        </if>
        <if test="area.equals('高明区')">
            select detail from dictionary    where   code  like  '%440608%'   and  kind ='06'  and   code  like  '%0000%' and detail like '%派出所%' and dictionary.detail not in(select detail from dictionary    where   code  like  '%440608%'   and  kind ='06'  and   code  like  '%0000%' and detail like '%已撤销%')
        </if>
        <if test="area.equals('顺德区')">
            select detail from dictionary    where   code  like  '%440606%'   and  kind ='06'  and   code  like  '%0000%' and detail like '%派出所%' and dictionary.detail not in(select detail from dictionary    where   code  like  '%440606%'   and  kind ='06'  and   code  like  '%0000%' and detail like '%已撤销%')
        </if>


    </select>
</mapper>